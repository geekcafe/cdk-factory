{
  "auto_scaling": {
    "name": "sample-asg",
    "vpc_id": "${VPC_ID}",
    "instance_type": "t3.medium",
    "min_capacity": 2,
    "max_capacity": 6,
    "desired_capacity": 2,
    "subnet_group_name": "private",
    "security_group_ids": ["${SECURITY_GROUP_ID}"],
    "health_check_type": "ELB",
    "health_check_grace_period": 300,
    "cooldown": 300,
    "termination_policies": ["OldestInstance", "Default"],
    "managed_policies": [
      "AmazonSSMManagedInstanceCore",
      "CloudWatchAgentServerPolicy",
      "AmazonEC2ContainerRegistryReadOnly"
    ],
    "ami_type": "amazon-linux-2023",
    "detailed_monitoring": true,
    "block_devices": [
      {
        "device_name": "/dev/xvda",
        "volume_size": 30,
        "volume_type": "gp3",
        "delete_on_termination": true,
        "encrypted": true
      }
    ],
    "container_config": {
      "ecr": {
        "account_id": "${ECR_ACCOUNT_ID}",
        "region": "${AWS_REGION}",
        "repo": "sample-app",
        "tag": "latest"
      },
      "database": {
        "secret_arn": "${DB_SECRET_ARN}"
      },
      "port": 8080
    },
    "user_data_commands": [
      "yum update -y",
      "yum install -y amazon-cloudwatch-agent",
      "systemctl enable amazon-cloudwatch-agent",
      "systemctl start amazon-cloudwatch-agent"
    ],
    "scaling_policies": [
      {
        "name": "cpu-scale-out",
        "type": "target_tracking",
        "metric_name": "CPUUtilization",
        "statistic": "Average",
        "period": 60,
        "steps": [
          {
            "lower": 0,
            "upper": 30,
            "change": -1
          },
          {
            "lower": 70,
            "change": 1
          }
        ]
      },
      {
        "name": "request-count-scale",
        "type": "step",
        "metric_name": "RequestCount",
        "statistic": "Sum",
        "period": 60,
        "steps": [
          {
            "lower": 0,
            "upper": 1000,
            "change": 0
          },
          {
            "lower": 1000,
            "upper": 5000,
            "change": 1
          },
          {
            "lower": 5000,
            "change": 2
          }
        ]
      }
    ],
    "update_policy": {
      "min_instances_in_service": 1,
      "max_batch_size": 1,
      "pause_time": 300
    },
    "tags": {
      "Environment": "dev",
      "Application": "SampleApp",
      "ManagedBy": "CDK-Factory"
    },
    "ssm_exports": {
      "asg_name": "/{deployment_name}/auto-scaling/name",
      "asg_arn": "/{deployment_name}/auto-scaling/arn"
    }
  }
}
